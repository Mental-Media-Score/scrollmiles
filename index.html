<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>ScrollMeter ‚Äì digitales Bewegungstagebuch</title>
  <style>
    :root { --accent:#ff007a; --yellow:#ffea00; }
    body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",sans-serif;background:#0f0f13;color:#fff;overflow-y:scroll;}
    /* Overlay */
    #meter{position:fixed;top:0;left:0;width:100%;background:rgba(0,0,0,.6);
      padding:8px 12px;font-size:.9rem;display:flex;flex-direction:column;gap:6px;
      align-items:center;z-index:10;backdrop-filter:blur(6px);}
    #bar{width:100%;height:6px;background:rgba(255,255,255,.2);border-radius:3px;overflow:hidden}
    #fill{height:100%;width:0;background:linear-gradient(90deg,#00ff88,#ffea00,#ff007a);transition:width .2s}
    /* Feed */
    .feed{margin-top:80px;display:flex;flex-direction:column;align-items:center;gap:20px;padding:0 0 200px}
    .card{width:90%;max-width:500px;background:#1a1a1f;border-radius:20px;overflow:hidden;box-shadow:0 4px 10px rgba(0,0,0,.4)}
    .card img{width:100%;height:260px;object-fit:cover}
    .content{padding:16px}
    .content h3{margin:0 0 8px;font-size:1.1rem;color:var(--yellow)}
    .content p{margin:0;color:#ccc;line-height:1.4}
    .stats{margin-top:6px;font-size:.8rem;color:#888}
    /* Summary */
    #showSummary{position:fixed;bottom:20px;right:20px;background:var(--accent);color:#fff;border:none;
      padding:12px 20px;border-radius:50px;font-weight:700;cursor:pointer;box-shadow:0 0 10px rgba(255,0,122,.4);z-index:15}
    #summary{display:none;position:fixed;inset:0;background:rgba(0,0,0,.95);z-index:20;
      display:flex;flex-direction:column;justify-content:center;align-items:center;text-align:center;padding:30px}
    #summary h2{color:var(--yellow);margin-top:0}
    #summary p{margin:.35rem 0}
    #evaluation{margin-top:.6rem;font-weight:600}
    #closeSummary{margin-top:16px;background:var(--accent);border:none;padding:10px 20px;color:#fff;border-radius:8px;cursor:pointer}
  </style>
</head>
<body>

  <!-- Overlay -->
  <div id="meter">
    <div>
      Heute: <span id="distance">0.00</span> m |
      Speed: <span id="speed">0.00</span> m/s |
      Pace: <span id="pace">‚Äì</span> /km
    </div>
    <div id="bar"><div id="fill"></div></div>
  </div>

  <!-- Feed -->
  <div class="feed" id="feed"></div>

  <!-- Button & Summary -->
  <button id="showSummary">üìä Tagesbilanz</button>

  <div id="summary">
    <h2>üìÖ Deine Scroll-Bilanz heute</h2>
    <p><b>Distanz:</b> <span id="sumDistance">0.00</span> m</p>
    <p><b>√ò Geschwindigkeit:</b> <span id="sumSpeed">0.00</span> m/s</p>
    <p><b>√ò Pace:</b> <span id="sumPace">‚Äì</span> min/km</p>
    <p id="evaluation"></p>
    <p style="margin-top:8px;color:#aaa;font-size:.9rem">(Joggen ‚âà 6:00 min/km)</p>
    <button id="closeSummary">Schlie√üen</button>
  </div>

  <script>
    // ===== Kalibrierung (Ger√§t & Pixeldichte) =====
    const isMobile = /Mobi|Android|iPhone|iPad/i.test(navigator.userAgent);
    const dpr = window.devicePixelRatio || 1;
    // Basis: ~10k CSS-px ‚âà 1 m (Heuristik). Mobile scrollt ‚Äûgr√∂ber‚Äú, Desktop ‚Äûfeiner‚Äú.
    const basePxPerM = isMobile ? 9000 : 12000;
    const PX_PER_METER = basePxPerM / dpr;

    // ===== Elemente =====
    const distanceEl = document.getElementById("distance");
    const speedEl = document.getElementById("speed");
    const paceEl = document.getElementById("pace");
    const fillEl = document.getElementById("fill");

    const sumDistance = document.getElementById("sumDistance");
    const sumSpeed = document.getElementById("sumSpeed");
    const sumPace = document.getElementById("sumPace");
    const evaluation = document.getElementById("evaluation");

    const summary = document.getElementById("summary");
    const showSummaryBtn = document.getElementById("showSummary");
    const closeSummaryBtn = document.getElementById("closeSummary");

    // ===== Tages-Storage =====
    const todayKey = "scrollmeter-" + new Date().toLocaleDateString("de-DE");
    let totalPx = parseFloat(localStorage.getItem(todayKey)) || 0;

    // ===== Laufende Messung =====
    let lastScroll = window.scrollY;
    let lastTime = performance.now();
    let samples = 0;
    let sumSpeedMs = 0; // m/s aufsummiert f√ºr Durchschnitt

    function updateOverlay(metersTotal, instSpeed) {
      // Pace aus m/s: secPerKm = 1000 / (m/s)
      let paceText = "‚Äì";
      if (instSpeed > 0) {
        const secPerKm = 1000 / instSpeed;
        const mm = Math.floor(secPerKm / 60);
        const ss = Math.floor(secPerKm % 60).toString().padStart(2, "0");
        paceText = `${mm}:${ss}`;
      }
      distanceEl.textContent = metersTotal.toFixed(2);
      speedEl.textContent = instSpeed.toFixed(2);
      paceEl.textContent = paceText;

      // Fortschritt gg. ‚ÄûTagesziel‚Äú 5 km (nur Visual)
      const percent = Math.min((metersTotal / 5000) * 100, 100);
      fillEl.style.width = percent + "%";
    }

    window.addEventListener("scroll", () => {
      const now = performance.now();
      let dt = (now - lastTime) / 1000;
      if (dt <= 0) dt = 0.016; // Schutz

      const current = window.scrollY;
      const deltaPx = Math.abs(current - lastScroll); // beide Richtungen z√§hlen
      lastScroll = current;
      lastTime = now;

      totalPx += deltaPx;
      localStorage.setItem(todayKey, totalPx);

      const metersDelta = deltaPx / PX_PER_METER;     // m (dieses Intervall)
      const metersTotal = totalPx / PX_PER_METER;     // m gesamt
      const instSpeed = metersDelta / dt;             // m/s

      // Samples f√ºr Tagesdurchschnitt
      if (isFinite(instSpeed) && instSpeed >= 0) {
        sumSpeedMs += instSpeed;
        samples++;
      }

      updateOverlay(metersTotal, instSpeed);
    });

    // ===== Summary =====
    showSummaryBtn.addEventListener("click", () => {
      const metersTotal = totalPx / PX_PER_METER;
      const avgSpeed = samples > 0 ? (sumSpeedMs / samples) : 0; // m/s
      const secPerKm = avgSpeed > 0 ? 1000 / avgSpeed : 0;
      const mm = Math.floor(secPerKm / 60);
      const ss = Math.floor(secPerKm % 60).toString().padStart(2, "0");
      const paceText = avgSpeed > 0 ? `${mm}:${ss}` : "‚Äì";

      sumDistance.textContent = metersTotal.toFixed(2);
      sumSpeed.textContent = avgSpeed.toFixed(2);
      sumPace.textContent = paceText;

      // Bewertungsskala je nach Pace
      let fb = "üü£ Noch keine Bewegung erfasst.";
      if (secPerKm > 0) {
        if (secPerKm > 600) fb = "üü¢ Entspannt unterwegs ‚Äì digital entschleunigt.";
        else if (secPerKm > 300) fb = "üü° Gute Balance ‚Äì bewusster Informationsfluss.";
        else if (secPerKm > 120) fb = "üü† Flott durch den Feed ‚Äì kurze Pausen tun gut.";
        else fb = "üî¥ Digitaler Sprint ‚Äì g√∂nn dir Erholung!";
      }
      evaluation.textContent = fb;
      summary.style.display = "flex";
    });

    closeSummaryBtn.addEventListener("click", () => {
      summary.style.display = "none";
    });

    // ===== Fake-Feed generieren (75 Karten) =====
    const feed = document.getElementById("feed");
    const texts = [
      "Warum wir scrollen, obwohl wir m√ºde sind.",
      "10 Tricks gegen Social-Media-M√ºdigkeit.",
      "Katzenvideo des Tages üêæ",
      "Mentale Gesundheit braucht Medienbewusstsein.",
      "Wie Worte wirken: kleine √Ñnderungen, gro√üe Effekte.",
      "Wenn Algorithmen deine Aufmerksamkeit wollen.",
      "Was dein Handy √ºber dein Mindset verr√§t.",
      "Evolution des Scrollens ‚Äì Zeitung ‚Üí TikTok.",
      "Eine Minute Achtsamkeit statt 100 Meter Scroll."
    ];
    for (let i = 0; i < 75; i++) {
      const card = document.createElement("div");
      card.className = "card";
      const img = document.createElement("img");
      img.src = `https://picsum.photos/seed/${i}/600/400`;
      const cont = document.createElement("div");
      cont.className = "content";
      const h = document.createElement("h3");
      h.textContent = texts[i % texts.length];
      const p = document.createElement("p");
      p.textContent = "Lorem ipsum dolor sit amet, consectetur adipiscing elit. Integer gravida neque nec ultricies tempor.";
      const s = document.createElement("div");
      s.className = "stats";
      s.textContent = `‚ù§Ô∏è ${Math.floor(Math.random()*900+100)} Likes   üí¨ ${Math.floor(Math.random()*90+10)} Kommentare`;
      cont.append(h,p,s);
      card.append(img,cont);
      feed.append(card);
    }

    // Initiale Anzeige (ohne Scroll)
    updateOverlay((totalPx / PX_PER_METER), 0);
  </script>
</body>
</html>
